# MP3 歌詞嵌入測試結果

## 測試日期
2025年12月1日

## 測試環境
- 播放器: (待確認)
- FFmpeg: 8.0.1
- Python mutagen 庫

---

## 測試結果總結

| 檔案 | 描述 | 結果 | 歌詞來源 | 音訊來源 |
|------|------|------|----------|----------|
| test_convert.mp3 | 原始 FLAC 直接轉換 | ✅ 成功 | 原始 FLAC 內嵌 | 原始 FLAC |
| test_direct_convert.mp3 | 重新從 FLAC 轉換 | ✅ 成功 | 原始 FLAC 內嵌 | 原始 FLAC |
| test_remerged_full.mp3 | 拆開後重新合併 | ✅ 成功 | 原始歌詞 | test_audio_only.mp3 |
| test_output_with_original_lrc.mp3 | output + 原始歌詞 | ✅ 成功 | 原始歌詞 | output.mp3 |
| test_remerged_python.mp3 | 少標籤版本 | ❌ 失敗 | 原始歌詞 | test_audio_only.mp3 |
| test_with_short_lrc.mp3 | 截短歌詞版本 | ❌ 失敗 | 我們的歌詞(截短) | output.mp3 |
| output_final.mp3 | 最終輸出 | ❌ 失敗 | 我們的歌詞 | output.mp3 |

---

## 成功案例分析

### 共同特徵
1. **歌詞內容**: 使用原始 FLAC 內嵌的歌詞
2. **歌詞長度**: 2790 字元
3. **歌詞格式**: 每行單一歌詞，行長度最大 48 字元
4. **標籤結構**: TXXX:USLT 格式

### 成功的 LRC 格式範例
```
[ti:Умри если меня не любишь]
[ar:Dakooka]
[al:Умри если меня не любишь]
[by:]
[offset:0]
[00:00.00] 歌曲標題
[00:01.79] 第一句歌詞
[00:01.79] 第一句翻譯
[00:04.42] 第二句歌詞
[00:04.42] 第二句翻譯
...
```

### 成功的 LRC 統計
- 總行數: 105 行
- 歌詞行數: 100 行
- 最長行: 48 字元
- 平均行長: 26.0 字元

---

## 失敗案例分析

### 共同特徵
1. **歌詞內容**: 我們生成的合併歌詞
2. **歌詞長度**: 2329-3083 字元
3. **歌詞格式**: 多句歌詞合併成一行，行長度最大 160 字元

### 失敗的 LRC 格式範例
```
[ti:Learning Track]
[ar:Multi-Language Learner]
[al:Learning Track]
[by:multilang-learner]
[offset:0]
[00:00.00] 多句歌詞合併在一起形成很長的一行...
[00:07.07] English translation also very long...
```

### 失敗的 LRC 統計
- 總行數: 52 行
- 歌詞行數: 46 行
- 最長行: 160 字元
- 平均行長: 63.8 字元

---

## 關鍵差異

| 項目 | 成功 | 失敗 |
|------|------|------|
| 每行歌詞數量 | 1 句 | 多句合併 |
| 最長行長度 | 48 字元 | 160 字元 |
| 平均行長度 | 26 字元 | 64 字元 |
| 原文/翻譯格式 | 同時間戳分開兩行 | 原文和翻譯在不同時間戳 |

---

## 可能的原因

1. **行長度限制**: 某些播放器可能有每行字元數限制
2. **格式差異**: 原始 LRC 每個時間戳只有一句，我們的合併了多句
3. **特殊字元**: 合併後可能產生了播放器無法解析的字元組合

---

## 建議的解決方案

1. **不合併歌詞**: 保持每行一句的格式
2. **限制行長度**: 每行不超過 50 字元
3. **原文翻譯同時間戳**: 
   ```
   [00:01.79] 原文歌詞
   [00:01.79] 翻譯
   ```

---

## 待驗證

- [ ] 確認是否為行長度限制
- [ ] 確認是否為多句合併的問題
- [ ] 確認播放器具體的 LRC 解析規則
